<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TK Phones â€” Sell Your Phone</title>
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel (for in-browser JSX) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Supabase JS v2 (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase-js.min.js"></script>
  <style>body{font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}</style>
</head>
<body class="bg-white text-slate-900">
  <div id="root"></div>

  <script type="text/babel">
    // =============================
    // Config (your creds here)
    // =============================
    const SUPABASE_URL = "https://befuoraecgrrorlfgfhm.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJlZnVvcmFlY2dycm9ybGZnZmhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2ODkwNjYsImV4cCI6MjA3NDI2NTA2Nn0.2iKmQhtTiS9DAniPE9mBy0100HzMtIkc49HBpaZow4s";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, { auth: { persistSession: true, autoRefreshToken: true } });

    // =============================
    // Utilities and defaults
    // =============================
    const { useState, useEffect, useMemo } = React;
    const cx = (...a) => a.filter(Boolean).join(" ");
    const defaultMultipliers = { 1: 0.2, 2: 0.45, 3: 0.7, 4: 0.9 };
    const defaultModels = [
      { id: "iph13-128", brand: "Apple", name: "iPhone 13 (128 GB)", base: 320 },
      { id: "iph12-64", brand: "Apple", name: "iPhone 12 (64 GB)", base: 180 },
      { id: "s21-128", brand: "Samsung", name: "Galaxy S21 (128 GB)", base: 170 },
      { id: "px6-128", brand: "Google", name: "Pixel 6 (128 GB)", base: 160 },
    ];
    const brandPalette = {
      primary: "#0046FF",
      primaryDark: "#002D9C",
      accent: "#0CC0DF",
      ink: "#0F172A",
      soft: "#F1F5F9",
    };

    function validateMultipliers(val) {
      const base = typeof val === "object" && val ? val : {};
      const out = { ...defaultMultipliers };
      [1,2,3,4].forEach(q => {
        const n = Number(base[q]);
        out[q] = Number.isFinite(n) ? n : defaultMultipliers[q];
      });
      return out;
    }
    function validateModels(val) {
      const arr = Array.isArray(val) ? val : [];
      const safe = arr.filter(m => m && typeof m === "object" && typeof m.id === "string" && typeof m.name === "string" && Number.isFinite(Number(m.base)));
      return safe.length ? safe : defaultModels;
    }

    function scoreIntegrity(answers) {
      let score = 4;
      if (!answers.powersOn) score -= 3;
      if (answers.screenCracks) score -= 1;
      if (Number(answers.battery) < 80) score -= 1;
      if (answers.waterDamage) score -= 2;
      if (!answers.storageOK) score -= 1;
      if (answers.carrierLocked) score -= 1;
      return Math.max(1, Math.min(4, score));
    }
    function calcEstimate(base, integrity, multipliers) {
      const mult = (multipliers && multipliers[integrity]) ?? 0;
      return Math.round(Number(base) * Number(mult));
    }

    const dal = {
      async getSession() {
        const { data, error } = await supabase.auth.getSession();
        if (error) return { user: null };
        return { user: data?.session?.user || null };
      },
      onAuth(cb) {
        const { data } = supabase.auth.onAuthStateChange((_event, session) => cb(session?.user || null));
        return () => { try { data?.subscription?.unsubscribe?.(); } catch {} };
      },
      async signInEmailPassword(email, password) {
        const { data, error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) throw error; return data.user;
      },
      async signInMagicLink(email) {
        const { data, error } = await supabase.auth.signInWithOtp({ email, options: { emailRedirectTo: window.location.href } });
        if (error) throw error; return data;
      },
      async signUpEmailPassword(email, password) {
        const { data, error } = await supabase.auth.signUp({ email, password, options: { emailRedirectTo: window.location.href } });
        if (error) throw error; return data.user;
      },
      async signOut() {
        await supabase.auth.signOut();
      },
      async fetchMultipliers() {
        const { data, error } = await supabase.from("multipliers").select("quality,value");
        if (error || !Array.isArray(data) || data.length === 0) return defaultMultipliers;
        const map = { ...defaultMultipliers };
        for (const row of data) map[Number(row.quality)] = Number(row.value);
        return validateMultipliers(map);
      },
      async upsertMultiplier(quality, value) {
        const { error } = await supabase.from("multipliers").upsert({ quality, value });
        if (error) throw error; return this.fetchMultipliers();
      },
      async fetchModels() {
        const { data, error } = await supabase.from("models").select("id,brand,name,base").order("name");
        if (error) return defaultModels;
        return validateModels(data);
      },
      async upsertModel(model) {
        const { error } = await supabase.from("models").upsert(model);
        if (error) throw error; return this.fetchModels();
      },
      async deleteModel(id) {
        const { error } = await supabase.from("models").delete().eq("id", id);
        if (error) throw error; return this.fetchModels();
      },
      async saveQuote(model_id, integrity, estimate) {
        const { error } = await supabase.from("quotes").insert({ model_id, integrity, estimate });
        if (error) console.warn("Quote insert error:", error.message);
      }
    };

    function useRouter() {
      const [route, setRoute] = useState("/");
      return { route, navigate: setRoute };
    }

    function Shell({ children, route, navigate, onOpenContact }) {
      return (
        <div className="min-h-screen bg-white text-slate-900">
          <header className="sticky top-0 z-40 border-b bg-white/80 backdrop-blur">
            <div className="mx-auto max-w-6xl px-4 py-3 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="h-9 w-9 rounded-xl" style={{background: "linear-gradient(135deg,#0046FF,#0CC0DF)"}} />
                <div className="font-bold tracking-tight text-xl">TK Phones</div>
              </div>
              <nav className="hidden md:flex items-center gap-6 text-sm">
                <NavLink label="Home" to="/" current={route} navigate={navigate} />
                <NavLink label="Sell your phone" to="/sell" current={route} navigate={navigate} />
                <NavLink label="How it works" to="/how" current={route} navigate={navigate} />
                <NavLink label="FAQs" to="/faqs" current={route} navigate={navigate} />
                <button onClick={onOpenContact} className="rounded-lg px-3 py-2 hover:bg-slate-100">Contact</button>
                <button onClick={() => navigate("/admin")} className="rounded-lg px-3 py-2 border border-slate-200 hover:bg-slate-50">Admin</button>
              </nav>
              <button className="md:hidden rounded-lg px-3 py-2 border" onClick={() => navigate("/menu")}>Menu</button>
            </div>
          </header>
          <main>{children}</main>
          <footer className="mt-16 border-t">
            <div className="mx-auto max-w-6xl px-4 py-10 grid gap-6 md:grid-cols-3 text-sm">
              <div>
                <div className="font-semibold mb-2">TK Phones</div>
                <p className="text-slate-600">Fast, fair offers for used phones. Get paid how you wantâ€”same day in many cases.</p>
              </div>
              <div>
                <div className="font-semibold mb-2">Links</div>
                <ul className="space-y-2">
                  <li><a className="hover:underline" onClick={() => navigate("/")}>Home</a></li>
                  <li><a className="hover:underline" onClick={() => navigate("/sell")}>Sell your phone</a></li>
                  <li><a className="hover:underline" onClick={() => navigate("/how")}>How it works</a></li>
                  <li><a className="hover:underline" onClick={() => navigate("/faqs")}>FAQs</a></li>
                </ul>
              </div>
              <div>
                <div className="font-semibold mb-2">Contact</div>
                <p className="text-slate-600">Have questions? Reach outâ€”our team is here to help.</p>
                <div className="mt-3 flex gap-3">
                  <button className="rounded-lg px-3 py-2 text-white" style={{backgroundColor: "#0046FF"}} onClick={onOpenContact}>Message us</button>
                  <button className="rounded-lg px-3 py-2 border border-slate-200" onClick={() => window.scrollTo({top:0, behavior:"smooth"})}>Back to top</button>
                </div>
              </div>
            </div>
            <div className="text-center text-xs text-slate-500 pb-8">Â© {new Date().getFullYear()} TK Phones â€” All rights reserved.</div>
          </footer>
        </div>
      );
    }

    function NavLink({ label, to, current, navigate }) {
      const active = current === to;
      return (
        <button onClick={() => navigate(to)} className={cx("rounded-lg px-3 py-2", active ? "bg-slate-100" : "hover:bg-slate-100")}>{label}</button>
      );
    }

    function Home({ navigate, onOpenStart }) {
      return (
        <section className="relative isolate">
          <div className="mx-auto max-w-6xl px-4 py-16 grid md:grid-cols-2 gap-10 items-center">
            <div>
              <h1 className="text-4xl md:text-5xl font-extrabold tracking-tight text-slate-900">
                Sell your phone in minutes with <span style={{color: "#0046FF"}}>TK Phones</span>
              </h1>
              <p className="mt-4 text-lg text-slate-600">Answer a few questions, get an instant estimate, schedule pickup or shipping, and get paid quickly.</p>
              <div className="mt-6 flex gap-3">
                <button onClick={onOpenStart} className="rounded-xl px-5 py-3 text-white font-semibold" style={{backgroundColor: "#0046FF"}}>Get my offer</button>
                <button onClick={() => navigate("/how")} className="rounded-xl px-5 py-3 border border-slate-200">How it works</button>
              </div>
              <div className="mt-8 flex flex-wrap gap-3 text-xs text-slate-600">
                <Badge>Sameâ€‘day payment available</Badge>
                <Badge>Free shipping kit</Badge>
                <Badge>No haggling</Badge>
              </div>
            </div>
            <div className="relative">
              <div className="aspect-[4/3] w-full rounded-2xl border bg-gradient-to-br from-slate-50 to-slate-100 grid place-items-center">
                <div className="text-center">
                  <div className="text-6xl">ðŸ“±</div>
                  <div className="mt-2 font-semibold">Trade-in that feels premium</div>
                  <div className="text-slate-500 text-sm">Clean UI â€¢ Quick quote â€¢ Transparent pricing</div>
                </div>
              </div>
              <div className="absolute -bottom-6 -left-6 bg-white shadow-xl rounded-xl p-4 border w-64">
                <div className="text-xs text-slate-500">Recent offers</div>
                <div className="mt-2 space-y-2 text-sm">
                  <div className="flex justify-between"><span>iPhone 13</span><span className="font-semibold">$250</span></div>
                  <div className="flex justify-between"><span>Galaxy S21</span><span className="font-semibold">$130</span></div>
                  <div className="flex justify-between"><span>Pixel 6</span><span className="font-semibold">$120</span></div>
                </div>
              </div>
            </div>
          </div>
        </section>
      );
    }

    function SellFlow({ models, multipliers, navigate, onComplete }) {
      const [step, setStep] = useState(1);
      const [modelId, setModelId] = useState(models[0]?.id || "");
      const [answers, setAnswers] = useState({
        powersOn: true,
        screenCracks: false,
        battery: 85,
        waterDamage: false,
        storageOK: true,
        carrierLocked: false,
      });

      const model = useMemo(() => models.find(m => m.id === modelId), [models, modelId]);
      const integrity = useMemo(() => scoreIntegrity(answers), [answers]);
      const estimate = useMemo(() => (model ? calcEstimate(model.base, integrity, multipliers) : 0), [model, multipliers, integrity]);

      return (
        <section className="mx-auto max-w-4xl px-4 py-12">
          <Steps current={step} total={3} />
          {step === 1 && (
            <Card title="Choose your phone">
              <div className="grid md:grid-cols-2 gap-4">
                <div>
                  <label className="text-sm text-slate-600">Model</label>
                  <select className="mt-1 w-full rounded-lg border px-3 py-2" value={modelId} onChange={(e)=>setModelId(e.target.value)}>
                    {models.map(m => (
                      <option key={m.id} value={m.id}>{m.name} â€” base ${m.base}</option>
                    ))}
                  </select>
                  <p className="mt-2 text-sm text-slate-600">Can't find yours? Ask us via Contactâ€”admin can add new models in minutes.</p>
                </div>
                <div className="rounded-xl border p-4 bg-slate-50">
                  <div className="text-sm text-slate-600">Selected</div>
                  <div className="mt-1 font-semibold">{model?.name}</div>
                  <div className="text-sm">Base value: ${model?.base}</div>
                </div>
              </div>
              <div className="mt-6 flex justify-between">
                <button className="rounded-lg px-4 py-2 border" onClick={()=>navigate("/")}>Back</button>
                <button className="rounded-lg px-4 py-2 text-white" style={{backgroundColor: "#0046FF"}} onClick={()=>setStep(2)}>Next</button>
              </div>
            </Card>
          )}

          {step === 2 && (
            <Card title="Answer a few questions">
              <div className="grid md:grid-cols-2 gap-4">
                <Toggle label="Does it power on?" value={answers.powersOn} onChange={(v)=>setAnswers(a=>({...a, powersOn:v}))} />
                <Toggle label="Any screen cracks?" value={answers.screenCracks} onChange={(v)=>setAnswers(a=>({...a, screenCracks:v}))} />
                <div>
                  <label className="text-sm text-slate-600">Battery health (estimate %)</label>
                  <input type="number" min={50} max={100} className="mt-1 w-full rounded-lg border px-3 py-2" value={answers.battery} onChange={(e)=>setAnswers(a=>({...a, battery:Number(e.target.value)}))} />
                </div>
                <Toggle label="Any signs of water damage?" value={answers.waterDamage} onChange={(v)=>setAnswers(a=>({...a, waterDamage:v}))} />
                <Toggle label="Storage and buttons all OK?" value={answers.storageOK} onChange={(v)=>setAnswers(a=>({...a, storageOK:v}))} />
                <Toggle label="Carrier locked?" value={answers.carrierLocked} onChange={(v)=>setAnswers(a=>({...a, carrierLocked:v}))} />
              </div>

              <div className="mt-6 rounded-xl border p-4 bg-slate-50">
                <div className="text-sm text-slate-600">Integrity rating (auto)</div>
                <div className="mt-1 text-2xl font-bold">{integrity} / 4</div>
                <div className="mt-2 text-sm">We use your answers to estimate condition. The final quote may adjust after inspection.</div>
              </div>

              <div className="mt-6 flex justify-between">
                <button className="rounded-lg px-4 py-2 border" onClick={()=>setStep(1)}>Back</button>
                <button className="rounded-lg px-4 py-2 text-white" style={{backgroundColor: "#0046FF"}} onClick={()=>setStep(3)}>See my offer</button>
              </div>
            </Card>
          )}

          {step === 3 && (
            <Card title="Your instant estimate">
              <div className="grid md:grid-cols-2 gap-6 items-start">
                <div>
                  <div className="text-sm text-slate-600">Model</div>
                  <div className="font-semibold">{model?.name}</div>
                  <div className="mt-4 text-sm text-slate-600">Integrity</div>
                  <div className="text-xl font-bold">{integrity} / 4</div>
                  <div className="mt-4 text-sm text-slate-600">Estimated payout</div>
                  <div className="text-3xl font-extrabold tracking-tight">${estimate}</div>
                  <div className="mt-2 text-xs text-slate-500">Based on adminâ€‘set multipliers for quality ratings.</div>
                </div>
                <div className="rounded-2xl border p-4 bg-slate-50">
                  <div className="font-semibold">Next steps</div>
                  <ol className="list-decimal ml-5 mt-2 space-y-2 text-sm text-slate-700">
                    <li>Schedule a pickup or request a free shipping kit.</li>
                    <li>We verify condition upon receipt.</li>
                    <li>Choose payout method (eâ€‘transfer, PayPal, gift card, etc.).</li>
                  </ol>
                  <div className="mt-4 flex gap-3">
                    <button className="rounded-lg px-4 py-2 text-white" style={{backgroundColor: "#0046FF"}} onClick={()=>{ dal.saveQuote(modelId, integrity, estimate); onComplete({ modelId, integrity, estimate }); }}>Continue</button>
                    <button className="rounded-lg px-4 py-2 border" onClick={()=>setStep(2)}>Edit answers</button>
                  </div>
                </div>
              </div>
            </Card>
          )}
        </section>
      );
    }

    function HowItWorks() {
      return (
        <section className="mx-auto max-w-6xl px-4 py-16">
          <h2 className="text-3xl font-extrabold tracking-tight">How it works</h2>
          <div className="mt-8 grid md:grid-cols-3 gap-6">
            <StepCard n={1} title="Tell us about your phone" text="Pick your model and answer quick condition questions." />
            <StepCard n={2} title="Get an instant estimate" text="We calculate a transparent offer using adminâ€‘set quality multipliers." />
            <StepCard n={3} title="Ship or drop off" text="Use our free kit or schedule pickup; get paid fast after verification." />
          </div>
        </section>
      );
    }

    function FAQs() {
      const faqs = [
        { q: "What if my phone doesnâ€™t power on?", a: "Itâ€™s still eligibleâ€”quality 1 usually applies. The estimate adjusts based on adminâ€‘set multipliers." },
        { q: "How fast do I get paid?", a: "Often same day after inspection. Otherwise within 1â€“2 business days." },
        { q: "Do you wipe my data?", a: "Yes, we follow secure erasure procedures on every device we purchase." },
        { q: "Can I cancel?", a: "If we havenâ€™t shipped your kit or scheduled pickup yet, you can cancel anytime." },
      ];
      return (
        <section className="mx-auto max-w-4xl px-4 py-16">
          <h2 className="text-3xl font-extrabold tracking-tight">FAQs</h2>
          <div className="mt-6 divide-y border rounded-xl">
            {faqs.map((f, i) => (
              <details key={i} className="p-4 group">
                <summary className="cursor-pointer font-medium list-none flex items-center justify-between">{f.q}<span className="text-slate-400 group-open:rotate-180 transition">âŒ„</span></summary>
                <p className="mt-2 text-slate-700">{f.a}</p>
              </details>
            ))}
          </div>
        </section>
      );
    }

    function Admin({ navigate }) {
      const [user, setUser] = useState(null);
      const [loading, setLoading] = useState(true);
      const [multipliers, setMultipliers] = useState(defaultMultipliers);
      const [models, setModels] = useState(defaultModels);
      const [email, setEmail] = useState("");
      const [password, setPassword] = useState("");
      const [errorMsg, setErrorMsg] = useState("");
      const [newModel, setNewModel] = useState({ brand: "", name: "", base: "" });
      const [testResults, setTestResults] = useState([]);

      useEffect(() => {
        let mounted = true;
        const unsub = supabase.auth.onAuthStateChange((_evt, session) => {
          if (mounted) setUser(session?.user || null);
        });
        (async () => {
          try {
            const { data } = await supabase.auth.getSession();
            if (mounted) setUser(data?.session?.user || null);
            const [mp, md] = await Promise.all([dal.fetchMultipliers(), dal.fetchModels()]);
            if (mounted) { setMultipliers(mp); setModels(md); }
          } catch (e) {
            setErrorMsg(String(e?.message || e));
          } finally {
            setLoading(false);
          }
        })();
        return () => { mounted = false; try { unsub?.data?.subscription?.unsubscribe?.(); } catch {} };
      }, []);

      async function handleSignIn(e) {
        e.preventDefault(); setErrorMsg("");
        try { const u = await dal.signInEmailPassword(email, password); setUser(u); }
        catch (e) { setErrorMsg(String(e?.message || e)); }
      }
      async function handleSignUp(e) {
        e.preventDefault(); setErrorMsg("");
        try { const u = await dal.signUpEmailPassword(email, password); setUser(u); }
        catch (e) { setErrorMsg(String(e?.message || e)); }
      }
      async function handleMagic() {
        setErrorMsg("");
        try { await dal.signInMagicLink(email); setErrorMsg("Magic link sent. Check your email."); }
        catch (e) { setErrorMsg(String(e?.message || e)); }
      }
      async function handleSignOut() { await dal.signOut(); setUser(null); }

      async function updateMultiplier(q, val) {
        try { const next = await dal.upsertMultiplier(q, val); setMultipliers(next); }
        catch (e) { setErrorMsg(String(e?.message || e)); }
      }

      async function addModel() {
        if(!newModel.brand || !newModel.name || !newModel.base) return;
        const id = `${newModel.name}`.toLowerCase().replace(/[^a-z0-9]+/g,"-");
        const item = { id, brand: newModel.brand, name: newModel.name, base: Number(newModel.base) };
        try {
          const next = await dal.upsertModel(item);
          setModels(next);
          setNewModel({ brand: "", name: "", base: "" });
        } catch (e) { setErrorMsg(String(e?.message || e)); }
      }

      async function removeModel(id) {
        try { const next = await dal.deleteModel(id); setModels(next); }
        catch (e) { setErrorMsg(String(e?.message || e)); }
      }

      function runDiagnostics() {
        const results = [];
        const mp = validateMultipliers(multipliers);
        const base = 100;
        const expected = { 1: Math.round(base * mp[1]), 2: Math.round(base * mp[2]), 3: Math.round(base * mp[3]), 4: Math.round(base * mp[4]) };
        [1,2,3,4].forEach(q => {
          const got = calcEstimate(base, q, mp);
          results.push({ name: `Estimate base=${base} quality=${q}`, pass: got === expected[q], got, expected: expected[q] });
        });
        const t1 = scoreIntegrity({ powersOn:true, screenCracks:false, battery:90, waterDamage:false, storageOK:true, carrierLocked:false });
        results.push({ name: "Integrity all good => 4", pass: t1 === 4, got: t1, expected: 4 });
        const t2 = scoreIntegrity({ powersOn:true, screenCracks:true, battery:90, waterDamage:false, storageOK:true, carrierLocked:false });
        results.push({ name: "Integrity screen crack => 3", pass: t2 === 3, got: t2, expected: 3 });
        const t3 = scoreIntegrity({ powersOn:true, screenCracks:false, battery:70, waterDamage:false, storageOK:true, carrierLocked:false });
        results.push({ name: "Integrity low battery => 3", pass: t3 === 3, got: t3, expected: 3 });
        const t4 = scoreIntegrity({ powersOn:true, screenCracks:false, battery:90, waterDamage:true, storageOK:true, carrierLocked:false });
        results.push({ name: "Integrity water damage => 2", pass: t4 === 2, got: t4, expected: 2 });
        const t5 = scoreIntegrity({ powersOn:false, screenCracks:false, battery:90, waterDamage:false, storageOK:true, carrierLocked:false });
        results.push({ name: "Integrity no power => 1 (clamped)", pass: t5 === 1, got: t5, expected: 1 });
        const base2 = 333; const q4 = 4; const got2 = calcEstimate(base2, q4, mp); const expected2 = Math.round(base2 * mp[q4]);
        results.push({ name: `Rounding estimate base=${base2} q=${q4}`, pass: got2 === expected2, got: got2, expected: expected2 });
        setTestResults(results);
      }

      if (loading) return (<section className="mx-auto max-w-md px-4 py-16"><Card title="Loading"><div className="text-sm text-slate-600">Fetching session & dataâ€¦</div></Card></section>);
      if (!user) {
        return (
          <section className="mx-auto max-w-md px-4 py-16">
            <Card title="Admin login (Supabase)">
              <form className="grid gap-3" onSubmit={handleSignIn}>
                <input className="rounded-lg border px-3 py-2" placeholder="Email" value={email} onChange={(e)=>setEmail(e.target.value)} />
                <input className="rounded-lg border px-3 py-2" type="password" placeholder="Password" value={password} onChange={(e)=>setPassword(e.target.value)} />
                <div className="flex gap-3 flex-wrap">
                  <button className="rounded-lg px-4 py-2 text-white" style={{backgroundColor: "#0046FF"}} type="submit">Sign in</button>
                  <button className="rounded-lg px-4 py-2 border" type="button" onClick={handleSignUp}>Sign up</button>
                  <button className="rounded-lg px-4 py-2 border" type="button" onClick={handleMagic}>Magic link</button>
                  <button className="rounded-lg px-4 py-2 border" type="button" onClick={()=>navigate("/")}>Back</button>
                </div>
              </form>
              <ul className="text-xs text-slate-500 mt-4 list-disc ml-5 space-y-1">
                <li>Add this origin to <em>Auth â†’ URL configuration â†’ Redirect URLs</em>: <code>{window.location.origin}</code></li>
              </ul>
              {errorMsg && <p className="text-sm text-red-600 mt-3">{errorMsg}</p>}
            </Card>
          </section>
        );
      }

      return (
        <section className="mx-auto max-w-5xl px-4 py-12">
          <div className="flex items-center justify-between">
            <h2 className="text-3xl font-extrabold tracking-tight">Admin dashboard</h2>
            <button className="rounded-lg px-3 py-2 border" onClick={handleSignOut}>Sign out</button>
          </div>
          <p className="mt-2 text-slate-600">Edit multipliers & manage models. Changes save to Supabase and instantly affect customer estimates.</p>

          <div className="mt-8 grid md:grid-cols-2 gap-8">
            <Card title="Quality multipliers (by integrity 1â€“4)">
              <div className="grid grid-cols-2 gap-4">
                {[1,2,3,4].map((q)=> (
                  <div key={q} className="rounded-xl border p-4">
                    <div className="text-sm text-slate-600">Quality {q}</div>
                    <input type="number" step="0.01" min={0} max={2} className="mt-1 w-full rounded-lg border px-3 py-2"
                      value={Number(multipliers[q]).toString()}
                      onChange={(e)=>updateMultiplier(q, Number(e.target.value))} />
                    <div className="text-xs text-slate-500 mt-1">Multiplier Ã— base price</div>
                  </div>
                ))}
              </div>
            </Card>

            <Card title="Add a phone model">
              <div className="grid gap-3">
                <input className="rounded-lg border px-3 py-2" placeholder="Brand (e.g., Apple)" value={newModel.brand} onChange={(e)=>setNewModel({...newModel, brand:e.target.value})} />
                <input className="rounded-lg border px-3 py-2" placeholder="Model name (e.g., iPhone 14 128GB)" value={newModel.name} onChange={(e)=>setNewModel({...newModel, name:e.target.value})} />
                <input type="number" className="rounded-lg border px-3 py-2" placeholder="Base price (e.g., 350)" value={newModel.base} onChange={(e)=>setNewModel({...newModel, base:e.target.value})} />
                <button className="rounded-lg px-4 py-2 text-white" style={{backgroundColor: "#0046FF"}} onClick={addModel}>Add model</button>
              </div>
            </Card>
          </div>

          <Card title="Diagnostics & tests">
            <div className="flex items-center gap-3">
              <button className="rounded-lg px-4 py-2 text-white" style={{backgroundColor: "#0046FF"}} onClick={runDiagnostics}>Run sanity tests</button>
              <span className="text-sm text-slate-500">Verifies pricing math and integrity scoring.</span>
            </div>
            {testResults.length > 0 && (
              <div className="mt-4 rounded-xl border divide-y">
                {testResults.map((t, i) => (
                  <div key={i} className="p-3 text-sm flex justify-between">
                    <div>{t.name}</div>
                    <div className={t.pass ? "text-green-600" : "text-red-600"}>{t.pass ? "PASS" : `FAIL (got ${t.got}, expected ${t.expected})`}</div>
                  </div>
                ))}
              </div>
            )}
          </Card>

          <Card title="Current catalog" className="mt-8">
            <div className="overflow-auto">
              <table className="w-full text-sm">
                <thead>
                  <tr className="text-left border-b">
                    <th className="py-2 pr-4">Brand</th>
                    <th className="py-2 pr-4">Name</th>
                    <th className="py-2 pr-4">Base</th>
                    <th className="py-2 pr-4">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {models.map((m) => (
                    <tr key={m.id} className="border-b last:border-none">
                      <td className="py-2 pr-4">{m.brand}</td>
                      <td className="py-2 pr-4">{m.name}</td>
                      <td className="py-2 pr-4">
                        <input type="number" className="w-28 rounded border px-2 py-1" value={m.base}
                          onChange={async (e)=>{
                            const val = Number(e.target.value);
                            await dal.upsertModel({ ...m, base: val });
                            const fresh = await dal.fetchModels();
                            setModels(fresh);
                          }} />
                      </td>
                      <td className="py-2 pr-4">
                        <button className="rounded px-3 py-1 border mr-2" onClick={()=>removeModel(m.id)}>Remove</button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </Card>
        </section>
      );
    }

    function Card({ title, children, className }) {
      return (
        <div className={cx("rounded-2xl border p-6 bg-white shadow-sm", className)}>
          {title && <div className="text-lg font-semibold mb-4">{title}</div>}
          {children}
        </div>
      );
    }
    function StepCard({ n, title, text }) {
      return (
        <div className="rounded-2xl border p-6 bg-white">
          <div className="flex items-center gap-3">
            <div className="h-9 w-9 rounded-full grid place-items-center text-white font-bold" style={{backgroundColor: "#0046FF"}}>{n}</div>
            <div className="font-semibold">{title}</div>
          </div>
          <p className="mt-3 text-sm text-slate-700">{text}</p>
        </div>
      );
    }
    function Steps({ current, total }) {
      return (
        <div className="mb-6 flex items-center gap-2">
          {Array.from({length: total}).map((_,i)=>{
            const idx = i+1;
            const active = idx <= current;
            return <div key={idx} className={cx("h-2 w-full rounded-full", active?"bg-slate-900":"bg-slate-200")} />;
          })}
        </div>
      );
    }
    function Toggle({ label, value, onChange }) {
      return (
        <label className="flex items-center justify-between rounded-xl border p-3 bg-white">
          <span className="text-sm">{label}</span>
          <button type="button" onClick={()=>onChange(!value)}
            className={cx("relative inline-flex h-6 w-11 items-center rounded-full transition", value?"bg-slate-900":"bg-slate-300")}
            aria-pressed={value}>
            <span className={cx("inline-block h-5 w-5 transform rounded-full bg-white transition", value?"translate-x-5":"translate-x-1")} />
          </button>
        </label>
      );
    }
    function Badge({ children }) {
      return <span className="rounded-full border px-3 py-1 text-slate-600 bg-white">{children}</span>;
    }
    function Modal({ open, onClose, title, children }) {
      if (!open) return null;
      return (
        <div className="fixed inset-0 z-50 grid place-items-center">
          <div className="absolute inset-0 bg-black/30" onClick={onClose} />
          <div className="relative z-10 w-full max-w-lg rounded-2xl border bg-white p-6 shadow-xl">
            <div className="flex items-center justify-between">
              <div className="text-lg font-semibold">{title}</div>
              <button className="rounded-lg px-3 py-1 border" onClick={onClose}>Close</button>
            </div>
            <div className="mt-4">{children}</div>
          </div>
        </div>
      );
    }
    function ContactForm() {
      const [name, setName] = useState("");
      const [email, setEmail] = useState("");
      const [msg, setMsg] = useState("");
      const [sent, setSent] = useState(false);
      return (
        <div>
          {sent ? (
            <div className="rounded-xl border p-4 bg-slate-50">Thanks! We received your message and will reply soon.</div>
          ) : (
            <div className="grid gap-3">
              <input className="rounded-lg border px-3 py-2" placeholder="Name" value={name} onChange={e=>setName(e.target.value)} />
              <input className="rounded-lg border px-3 py-2" placeholder="Email" value={email} onChange={e=>setEmail(e.target.value)} />
              <textarea className="rounded-lg border px-3 py-2" placeholder="How can we help?" rows={4} value={msg} onChange={e=>setMsg(e.target.value)} />
              <button className="rounded-lg px-4 py-2 text-white" style={{backgroundColor: "#0046FF"}} onClick={()=>setSent(true)}>Send</button>
            </div>
          )}
        </div>
      );
    }
    function MobileMenu({ navigate }) {
      const items = [
        { label: "Home", to: "/" },
        { label: "Sell your phone", to: "/sell" },
        { label: "How it works", to: "/how" },
        { label: "FAQs", to: "/faqs" },
        { label: "Admin", to: "/admin" },
      ];
      return (
        <section className="px-4 py-8">
          <div className="mx-auto max-w-md grid gap-2">
            {items.map(it => (
              <button key={it.to} onClick={()=>navigate(it.to)} className="rounded-xl border p-4 text-left">
                {it.label}
              </button>
            ))}
          </div>
        </section>
      );
    }

    function App() {
      const { route, navigate } = useRouter();
      const [contactOpen, setContactOpen] = useState(false);
      const [startOpen, setStartOpen] = useState(false);
      const [lastOffer, setLastOffer] = useState(null);
      const [multipliers, setMultipliers] = useState(defaultMultipliers);
      const [models, setModels] = useState(defaultModels);

      useEffect(() => {
        let mounted = true;
        (async () => {
          const [mp, md] = await Promise.all([dal.fetchMultipliers(), dal.fetchModels()]);
          if (!mounted) return;
          setMultipliers(mp); setModels(md);
        })();
        return () => { mounted = false; };
      }, []);

      return (
        <Shell route={route} navigate={navigate} onOpenContact={()=>setContactOpen(true)}>
          {route === "/" && <Home navigate={navigate} onOpenStart={()=>{ setStartOpen(true); navigate("/sell"); }} />}
          {route === "/sell" && (
            <SellFlow
              models={models}
              multipliers={multipliers}
              navigate={navigate}
              onComplete={(o)=>{ setLastOffer(o); setContactOpen(true); }}
            />
          )}
          {route === "/how" && <HowItWorks />}
          {route === "/faqs" && <FAQs />}
          {route === "/admin" && (<Admin navigate={navigate} />)}
          {route === "/menu" && <MobileMenu navigate={navigate} />}

          <Modal open={contactOpen} onClose={()=>setContactOpen(false)} title="Contact TK Phones">
            {lastOffer && (
              <div className="mb-4 rounded-xl border p-3 text-sm bg-slate-50">
                <div className="font-medium">Your offer summary</div>
                <div>Model ID: {lastOffer.modelId}</div>
                <div>Integrity: {lastOffer.integrity} / 4</div>
                <div>Estimate: ${lastOffer.estimate}</div>
              </div>
            )}
            <ContactForm />
          </Modal>

          <Modal open={startOpen} onClose={()=>setStartOpen(false)} title="Start your quote">
            <div className="text-sm text-slate-600">Head to the Sell page and follow the steps to get an instant estimate.</div>
            <div className="mt-4"><button className="rounded-lg px-4 py-2 text-white" style={{backgroundColor: "#0046FF"}} onClick={()=>{ setStartOpen(false); navigate("/sell"); }}>Go to Sell</button></div>
          </Modal>
        </Shell>
      );
    }

    function useRouter() {
      const [route, setRoute] = React.useState("/");
      return { route, navigate: setRoute };
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
